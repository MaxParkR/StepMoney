<!--
  Vista del Dashboard - Pantalla Principal
  
  Esta es la interfaz visual del dashboard.
  Muestra tarjetas con informaci칩n financiera del usuario.
-->

<!-- Encabezado de la p치gina -->
<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      <div class="d-flex align-center">
        <ion-icon name="wallet" style="margin-right: 8px;"></ion-icon>
        StepMoney
      </div>
    </ion-title>
  </ion-toolbar>
</ion-header>

<!-- Contenido principal -->
<ion-content [fullscreen]="true">
  
  <!-- Refresh para actualizar datos (deslizar hacia abajo) -->
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Encabezado grande con efecto parallax -->
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Inicio</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Spinner de carga -->
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
    <p class="text-muted">Cargando datos...</p>
  </div>

  <!-- Contenido del Dashboard -->
  <div *ngIf="!isLoading">
    
    <!-- Tarjeta de Balance General - Dise침o Moderno -->
    <div class="balance-card-modern">
      <div class="balance-header-section">
        <div>
          <p class="balance-label">Hola 游녦</p>
          <h2 class="welcome-text">Balance Actual</h2>
        </div>
        <ion-icon name="notifications-outline" class="notification-icon"></ion-icon>
      </div>
      
      <div class="balance-card-gradient">
        <div class="balance-content">
          <div class="card-decoration">
            <ion-icon name="card-outline" class="card-icon"></ion-icon>
          </div>
          <p class="balance-label-small">Balance Disponible</p>
          <h1 class="balance-amount">{{ formatCurrency(summary.balance) }}</h1>
          <div class="balance-footer">
            <div>
              <p class="card-number">餃餃餃餃 餃餃餃餃 餃餃餃餃 1234</p>
            </div>
            <div class="exp-date">
              <p>Mes Actual</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="income-expense-row">
        <div class="stat-item income-stat">
          <div class="stat-icon-wrapper income-bg">
            <ion-icon name="trending-up"></ion-icon>
          </div>
          <div class="stat-content">
            <p class="stat-label">Ingresos</p>
            <p class="stat-value">{{ formatCurrency(summary.totalIncome) }}</p>
          </div>
        </div>
        <div class="stat-item expense-stat">
          <div class="stat-icon-wrapper expense-bg">
            <ion-icon name="trending-down"></ion-icon>
          </div>
          <div class="stat-content">
            <p class="stat-label">Gastos</p>
            <p class="stat-value">{{ formatCurrency(summary.totalExpense) }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Servicios / Acciones R치pidas - Dise침o Moderno -->
    <div class="services-section">
      <h3 class="section-title">Servicios</h3>
      <div class="services-grid">
        <div class="service-item" (click)="goToTransactions()">
          <div class="service-icon-wrapper wallet-bg">
            <ion-icon name="wallet-outline"></ion-icon>
          </div>
          <p class="service-label">Wallet</p>
        </div>
        
        <div class="service-item" (click)="goToTransactions()">
          <div class="service-icon-wrapper transfer-bg">
            <ion-icon name="swap-horizontal-outline"></ion-icon>
          </div>
          <p class="service-label">Transfer</p>
        </div>
        
        <div class="service-item" [routerLink]="['/pages/reports']">
          <div class="service-icon-wrapper pay-bg">
            <ion-icon name="card-outline"></ion-icon>
          </div>
          <p class="service-label">Pay</p>
        </div>
        
        <div class="service-item" (click)="goToGoals()">
          <div class="service-icon-wrapper topup-bg">
            <ion-icon name="add-circle-outline"></ion-icon>
          </div>
          <p class="service-label">Topup</p>
        </div>
      </div>
    </div>

    <!-- Transacciones Recientes - Dise침o Moderno -->
    <div class="recent-transactions-section" *ngIf="summary.byCategory.length > 0">
      <div class="section-header">
        <h3 class="section-title">Transacciones Recientes</h3>
        <a class="view-all-link" (click)="goToTransactions()">Ver Todo</a>
      </div>
      
      <div class="transactions-list">
        <div class="transaction-item" *ngFor="let category of getTopCategories()">
          <div class="transaction-left">
            <div class="transaction-icon-wrapper" [style.background]="category.categoryColor + '20'">
              <ion-icon 
                [name]="category.categoryIcon" 
                [style.color]="category.categoryColor">
              </ion-icon>
            </div>
            <div class="transaction-info">
              <h4>{{ category.categoryName }}</h4>
              <p>{{ category.count }} transacciones</p>
            </div>
          </div>
          <div class="transaction-right">
            <p class="transaction-amount negative">-{{ formatCurrency(category.total) }}</p>
            <p class="transaction-percentage">{{ category.percentage.toFixed(1) }}%</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Secci칩n de Metas de Ahorro -->
    <ion-card *ngIf="goalsProgress.length > 0">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="trophy" style="margin-right: 8px; vertical-align: middle;"></ion-icon>
          Mis Metas de Ahorro
        </ion-card-title>
        <ion-card-subtitle>{{ goalsStats.activeGoals }} metas activas</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <div *ngFor="let progress of goalsProgress.slice(0, 3)" class="goal-item">
          <div class="goal-header">
            <h3 class="goal-name">{{ progress.goalName }}</h3>
            <span class="goal-percentage" [class.text-success]="progress.percentage >= 100">
              {{ progress.percentage }}%
            </span>
          </div>
          <ion-progress-bar 
            [value]="progress.percentage / 100" 
            [color]="progress.percentage >= 100 ? 'success' : 'primary'">
          </ion-progress-bar>
          <div class="goal-footer">
            <p class="text-muted">
              Faltan {{ formatCurrency(progress.remaining) }}
            </p>
            <p class="text-muted" *ngIf="progress.daysRemaining">
              {{ progress.daysRemaining }} d칤as restantes
            </p>
          </div>
        </div>
        <ion-button expand="block" fill="clear" (click)="goToGoals()">
          Ver todas las metas
          <ion-icon name="arrow-forward" slot="end"></ion-icon>
        </ion-button>
      </ion-card-content>
    </ion-card>

    <!-- Estad칤sticas Generales -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="stats-chart" style="margin-right: 8px; vertical-align: middle;"></ion-icon>
          Resumen General
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-grid>
          <ion-row>
            <ion-col size="6">
              <div class="stat-box">
                <ion-icon name="receipt" color="primary"></ion-icon>
                <h3>{{ summary.transactionCount }}</h3>
                <p class="text-muted">Transacciones</p>
              </div>
            </ion-col>
            <ion-col size="6">
              <div class="stat-box">
                <ion-icon name="flag" color="success"></ion-icon>
                <h3>{{ goalsStats.completedGoals }}/{{ goalsStats.totalGoals }}</h3>
                <p class="text-muted">Metas Completadas</p>
              </div>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-card-content>
    </ion-card>

    <!-- Mensaje cuando no hay datos -->
    <div *ngIf="!hasData()" class="empty-state">
      <ion-icon name="document-text-outline" size="large" color="medium"></ion-icon>
      <h2>춰Bienvenido a StepMoney!</h2>
      <p class="text-muted">
        Comienza registrando tu primera transacci칩n o creando una meta de ahorro.
      </p>
      <ion-button expand="block" (click)="goToTransactions()">
        <ion-icon name="add-circle" slot="start"></ion-icon>
        Registrar Primera Transacci칩n
      </ion-button>
    </div>

    <!-- Espaciado inferior para que no se solape con los tabs -->
    <div style="height: 80px;"></div>
  </div>

</ion-content>
